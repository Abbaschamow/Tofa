<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Chamow Chat App</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

  <style>
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',sans-serif}
    body{background:#f4f6fb;color:#333;height:100vh;overflow:hidden;display:flex;align-items:center;justify-content:center;transition:0.3s}
    body.dark{background:#1e1e1e;color:#fff}
    .hidden{display:none!important}
    .auth-container,.main-app{width:100%;height:100vh;display:flex;align-items:center;justify-content:center;flex-direction:column}
    .auth-box{background:#fff;padding:2rem;border-radius:10px;box-shadow:0 4px 20px rgba(0,0,0,0.1);width:90%;max-width:400px}
    body.dark .auth-box{background:#2a2a2a;color:#fff}
    .auth-box h2{text-align:center;margin-bottom:1.5rem}
    .form-group{margin-bottom:1rem}
    .form-group label{display:block;margin-bottom:.5rem}
    .form-group input{width:100%;padding:.7rem;border:1px solid #ccc;border-radius:5px}
    body.dark .form-group input{background:#3a3a3a;border-color:#555;color:#fff}
    .btn{width:100%;padding:.75rem;background:#6e8efb;color:#fff;border:none;border-radius:5px;font-size:1rem;cursor:pointer;transition:.3s}
    .btn:hover{background:#5a7dfa}
    .auth-switch{text-align:center;margin-top:1rem}
    .auth-switch a{color:#6e8efb;cursor:pointer;text-decoration:none}
    .navbar{width:100%;background:#6e8efb;color:#fff;padding:1rem;display:flex;justify-content:space-between;align-items:center}
    .navbar-nav{display:flex;gap:1rem;align-items:center}
    .nav-link{cursor:pointer}
    .main-content{flex:1;width:100%;display:flex;height:calc(100vh - 60px)}
    .user-list{width:250px;background:#fff;border-right:1px solid #eee;padding:1rem;overflow-y:auto}
    body.dark .user-list{background:#2a2a2a;border-color:#444}
    .user-item{padding:.6rem;border-radius:5px;margin-bottom:.4rem;cursor:pointer;transition:.3s}
    .user-item:hover{background:#f0f0f0}
    body.dark .user-item:hover{background:#3a3a3a}
    .user-item.active{background:#e6eeff;color:#6e8efb}
    .chat-room{flex:1;display:flex;flex-direction:column}
    .chat-header{padding:1rem;border-bottom:1px solid #eee;background:#fff}
    body.dark .chat-header{background:#2a2a2a;border-color:#444}
    .messages-container{flex:1;overflow-y:auto;padding:1rem;background:#f9f9f9;scroll-behavior:smooth}
    body.dark .messages-container{background:#1e1e1e}
    .message{margin-bottom:1rem;padding:.75rem;border-radius:10px;max-width:70%;word-wrap:break-word}
    .sent{background:#6e8efb;color:#fff;margin-left:auto;border-bottom-right-radius:0}
    .received{background:#fff;border:1px solid #eee;margin-right:auto;border-bottom-left-radius:0}
    body.dark .received{background:#2a2a2a;border-color:#444}
    .message-input{display:flex;padding:1rem;background:#fff;border-top:1px solid #eee}
    body.dark .message-input{background:#2a2a2a;border-color:#444}
    .message-input input{flex:1;padding:.7rem;border:1px solid #ccc;border-radius:20px;margin-right:.5rem}
    body.dark .message-input input{background:#3a3a3a;color:#fff;border-color:#555}
    .message-input button{background:#6e8efb;color:#fff;border:none;border-radius:50%;width:45px;height:45px;cursor:pointer}
    #settings-box,#profile-box{padding:1rem}
    #settings-box h3,#profile-box h3{text-align:center;margin-bottom:1rem}
    @media(max-width:768px){.user-list{width:200px}}
    @media(max-width:576px){.main-content{flex-direction:column}.user-list{width:100%;height:150px;border-bottom:1px solid #eee;border-right:none}}
  </style>
</head>
<body>

  <!-- AUTH SCREENS -->
  <div id="auth-container" class="auth-container">
    <div id="login-box" class="auth-box">
      <h2>Log In</h2>
      <form id="loginForm">
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="login-email" required />
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="login-password" required />
        </div>
        <button type="submit" class="btn">Log In</button>
      </form>
      <div id="login-msg" style="margin-top:.5rem;color:red;"></div>
      <div class="auth-switch">No account? <a id="show-register">Sign Up</a></div>
    </div>

    <div id="register-box" class="auth-box hidden">
      <h2>Sign Up</h2>
      <form id="registerForm">
        <div class="form-group">
          <label>Display Name</label>
          <input type="text" id="register-name" required />
        </div>
        <div class="form-group">
          <label>Email</label>
          <input type="email" id="register-email" required />
        </div>
        <div class="form-group">
          <label>Password</label>
          <input type="password" id="register-password" required minlength="6" />
        </div>
        <button type="submit" class="btn">Sign Up</button>
      </form>
      <div id="register-msg" style="margin-top:.5rem;color:red;"></div>
      <div class="auth-switch">Already have an account? <a id="show-login">Log In</a></div>
    </div>
  </div>

  <!-- MAIN APP -->
  <div id="main-app" class="main-app hidden">
    <div class="navbar">
      <div class="navbar-brand">Chamow Chat</div>
      <div class="navbar-nav">
        <div class="nav-link" id="profile-link">Profile</div>
        <div class="nav-link" id="settings-link">Settings</div>
        <div class="nav-link" id="logout-btn">Logout</div>
      </div>
    </div>

    <div class="main-content">
      <div class="user-list" id="user-list-box">
        <h3>Users</h3>
        <div id="users-list">Loading...</div>
      </div>

      <div class="chat-room" id="chat-box">
        <div class="chat-header">
          <h3 id="chat-with">Select a user</h3>
        </div>
        <div class="messages-container" id="messages"></div>
        <div class="message-input">
          <input type="text" id="messageInput" placeholder="Type a message..." disabled />
          <button id="sendBtn" disabled>âž¤</button>
        </div>
      </div>

      <div id="profile-box" class="hidden">
        <h3>Edit Profile</h3>
        <input type="text" id="edit-name" placeholder="New display name" />
        <input type="file" id="edit-photo" />
        <button class="btn" id="save-profile">Save Changes</button>
      </div>

      <div id="settings-box" class="hidden">
        <h3>Settings</h3>
        <button class="btn" id="toggle-theme">Toggle Dark Mode</button>
        <button class="btn" id="delete-account" style="background:#ff5a5a;margin-top:1rem;">Delete Account</button>
      </div>
    </div>
  </div>

  <script>
    // Firebase Config
    const firebaseConfig = {
  apiKey: "AIzaSyB1fQdrmOJWDh4dEdQTFucj9BUeQmH_yew",
  authDomain: "whatsapp-web-944f9.firebaseapp.com",
  databaseURL: "https://whatsapp-web-944f9-default-rtdb.firebaseio.com",
  projectId: "whatsapp-web-944f9",
  storageBucket: "whatsapp-web-944f9.firebasestorage.app",
  messagingSenderId: "975370289693",
  appId: "1:975370289693:web:23390019b3b1c216a0fcf4"
};
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();
    const storage = firebase.storage();

    // Elements
    const authContainer = document.getElementById("auth-container");
    const loginBox = document.getElementById("login-box");
    const registerBox = document.getElementById("register-box");
    const mainApp = document.getElementById("main-app");
    const usersList = document.getElementById("users-list");
    const chatWith = document.getElementById("chat-with");
    const messagesDiv = document.getElementById("messages");
    const messageInput = document.getElementById("messageInput");
    const sendBtn = document.getElementById("sendBtn");
    const profileBox = document.getElementById("profile-box");
    const settingsBox = document.getElementById("settings-box");
    const chatBox = document.getElementById("chat-box");
    const userListBox = document.getElementById("user-list-box");

    let currentUser = null;
    let selectedUser = null;
    let unsubscribeMessages = null;

    // Switch screens
    document.getElementById("show-register").onclick = () => {
      loginBox.classList.add("hidden");
      registerBox.classList.remove("hidden");
    };
    document.getElementById("show-login").onclick = () => {
      registerBox.classList.add("hidden");
      loginBox.classList.remove("hidden");
    };

    // Auth
    auth.onAuthStateChanged(user => {
      if (user) {
        currentUser = user;
        authContainer.classList.add("hidden");
        mainApp.classList.remove("hidden");
        loadUsers();
      } else {
        mainApp.classList.add("hidden");
        authContainer.classList.remove("hidden");
      }
    });

    // Register
    document.getElementById("registerForm").addEventListener("submit", e => {
      e.preventDefault();
      const name = document.getElementById("register-name").value;
      const email = document.getElementById("register-email").value;
      const password = document.getElementById("register-password").value;
      auth.createUserWithEmailAndPassword(email, password)
        .then(cred => db.collection("users").doc(cred.user.uid).set({
          uid: cred.user.uid, name, email, createdAt: Date.now()
        }))
        .catch(err => document.getElementById("register-msg").innerText = err.message);
    });

    // Login
    document.getElementById("loginForm").addEventListener("submit", e => {
      e.preventDefault();
      const email = document.getElementById("login-email").value;
      const password = document.getElementById("login-password").value;
      auth.signInWithEmailAndPassword(email, password)
        .catch(err => document.getElementById("login-msg").innerText = err.message);
    });

    // Logout
    document.getElementById("logout-btn").onclick = () => auth.signOut();

    // Load users
    function loadUsers() {
      db.collection("users").onSnapshot(snapshot => {
        usersList.innerHTML = "";
        snapshot.forEach(doc => {
          const user = doc.data();
          if (user.uid !== currentUser.uid) {
            const div = document.createElement("div");
            div.className = "user-item";
            div.innerText = user.name;
            div.onclick = () => selectUser(user);
            usersList.appendChild(div);
          }
        });
      });
    }

    // Select chat user
    function selectUser(user) {
      selectedUser = user;
      chatWith.innerText = "Chat with " + user.name;
      messageInput.disabled = false;
      sendBtn.disabled = false;
      messagesDiv.innerHTML = "Loading messages...";
      profileBox.classList.add("hidden");
      settingsBox.classList.add("hidden");
      chatBox.classList.remove("hidden");
      userListBox.classList.remove("hidden");

      if (unsubscribeMessages) unsubscribeMessages();
      const chatId = [currentUser.uid, user.uid].sort().join("_");
      unsubscribeMessages = db.collection("chats").doc(chatId)
        .collection("messages").orderBy("timestamp")
        .onSnapshot(snapshot => {
          messagesDiv.innerHTML = "";
          snapshot.forEach(doc => {
            const msg = doc.data();
            const div = document.createElement("div");
            div.className = "message " + (msg.sender === currentUser.uid ? "sent" : "received");
            div.innerText = msg.text;
            messagesDiv.appendChild(div);
          });
          messagesDiv.scrollTop = messagesDiv.scrollHeight;
        });
    }

    // Send message
    sendBtn.onclick = sendMessage;
    messageInput.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });
    function sendMessage() {
      const text = messageInput.value.trim();
      if (!text || !selectedUser) return;
      const chatId = [currentUser.uid, selectedUser.uid].sort().join("_");
      db.collection("chats").doc(chatId).collection("messages").add({
        text,
        sender: currentUser.uid,
        receiver: selectedUser.uid,
        timestamp: Date.now()
      });
      messageInput.value = "";
    }

    // Profile
    document.getElementById("profile-link").onclick = () => {
      chatBox.classList.add("hidden");
      userListBox.classList.add("hidden");
      settingsBox.classList.add("hidden");
      profileBox.classList.remove("hidden");
    };
    document.getElementById("save-profile").onclick = async () => {
      const newName = document.getElementById("edit-name").value.trim();
      const photoFile = document.getElementById("edit-photo").files[0];
      if (newName) await db.collection("users").doc(currentUser.uid).update({ name: newName });
      if (photoFile) {
        const ref = storage.ref(`profiles/${currentUser.uid}.jpg`);
        await ref.put(photoFile);
        const url = await ref.getDownloadURL();
        await db.collection("users").doc(currentUser.uid).update({ photo: url });
      }
      alert("Profile updated!");
    };

    // Settings
    document.getElementById("settings-link").onclick = () => {
      chatBox.classList.add("hidden");
      userListBox.classList.add("hidden");
      profileBox.classList.add("hidden");
      settingsBox.classList.remove("hidden");
    };
    document.getElementById("toggle-theme").onclick = () => document.body.classList.toggle("dark");
    document.getElementById("delete-account").onclick = async () => {
      if (confirm("Are you sure you want to delete your account?")) {
        await db.collection("users").doc(currentUser.uid).delete();
        await currentUser.delete();
        alert("Account deleted.");
      }
    };
  </script>
</body>
</html>