<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Private Chat App - Chamow</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f3f4f6;
      margin: 0;
      padding: 0;
    }
    .container {
      width: 100%;
      max-width: 400px;
      margin: 30px auto;
      background: #fff;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
      overflow: hidden;
    }
    header {
      background: #3b82f6;
      color: white;
      text-align: center;
      padding: 10px;
    }
    .form {
      padding: 20px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border-radius: 5px;
      border: 1px solid #ccc;
    }
    button {
      background: #3b82f6;
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background: #2563eb;
    }
    .chat-box {
      height: 300px;
      overflow-y: auto;
      border: 1px solid #ddd;
      padding: 10px;
    }
    .message {
      padding: 8px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .sent { background: #3b82f6; color: white; text-align: right; }
    .received { background: #e5e7eb; color: #111827; text-align: left; }
    .profile {
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 15px;
    }
    .profile img {
      width: 80px; height: 80px;
      border-radius: 50%;
      border: 2px solid #3b82f6;
      margin-bottom: 10px;
    }
    .hidden { display: none; }
    .settings {
      padding: 20px;
    }
  </style>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

</head>
<body>

<div class="container" id="auth-container">
  <header><h2>Chamow Chat</h2></header>

  <div id="login-form" class="form">
    <h3>Login</h3>
    <input type="email" id="login-email" placeholder="Email">
    <input type="password" id="login-password" placeholder="Password">
    <button onclick="login()">Login</button>
    <p>Don’t have an account? <a href="#" onclick="showRegister()">Register</a></p>
  </div>

  <div id="register-form" class="form hidden">
    <h3>Register</h3>
    <input type="text" id="register-name" placeholder="Full Name">
    <input type="email" id="register-email" placeholder="Email">
    <input type="password" id="register-password" placeholder="Password">
    <button onclick="register()">Create Account</button>
    <p>Already have an account? <a href="#" onclick="showLogin()">Login</a></p>
  </div>
</div>

<!-- Profile -->
<div class="container hidden" id="profile-container">
  <header><h2>My Profile</h2></header>
  <div class="profile">
    <img id="profile-avatar" src="https://i.imgur.com/0y0y0y0.png" alt="Avatar">
    <input type="file" id="avatar-upload" onchange="uploadAvatar(event)">
    <input type="text" id="profile-name" placeholder="Enter name">
    <button onclick="saveProfile()">Save Profile</button>
    <button onclick="openChat()">Go to Chat</button>
    <button onclick="logout()">Logout</button>
  </div>
</div>

<!-- Chat -->
<div class="container hidden" id="chat-container">
  <header>
    <h2>Private Chat</h2>
    <button onclick="openSettings()">⚙️</button>
  </header>
  <div class="form">
    <input type="text" id="chat-with" placeholder="Chat with (email)">
    <div class="chat-box" id="chat-box"></div>
    <input type="text" id="message-input" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<!-- Settings -->
<div class="container hidden" id="settings-container">
  <header><h2>Settings</h2></header>
  <div class="settings">
    <label>Change Display Name:</label>
    <input type="text" id="settings-name" placeholder="New name">
    <button onclick="updateSettings()">Save</button>
    <button onclick="openChat()">Back</button>
  </div>
</div>

<script>
  // Firebase Config (Replace with your project credentials)
  const firebaseConfig = {
  apiKey: "AIzaSyB1fQdrmOJWDh4dEdQTFucj9BUeQmH_yew",
  authDomain: "whatsapp-web-944f9.firebaseapp.com",
  databaseURL: "https://whatsapp-web-944f9-default-rtdb.firebaseio.com",
  projectId: "whatsapp-web-944f9",
  storageBucket: "whatsapp-web-944f9.firebasestorage.app",
  messagingSenderId: "975370289693",
  appId: "1:975370289693:web:23390019b3b1c216a0fcf4"
};

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.database();
  const storage = firebase.storage();

  // ===== AUTH FUNCTIONS =====
  function showRegister() {
    document.getElementById('login-form').classList.add('hidden');
    document.getElementById('register-form').classList.remove('hidden');
  }
  function showLogin() {
    document.getElementById('register-form').classList.add('hidden');
    document.getElementById('login-form').classList.remove('hidden');
  }

  function register() {
    const name = document.getElementById('register-name').value.trim();
    const email = document.getElementById('register-email').value;
    const password = document.getElementById('register-password').value;

    if (!name || !email || !password) return alert("All fields required!");

    auth.createUserWithEmailAndPassword(email, password)
    .then(cred => {
      db.ref('users/' + cred.user.uid).set({
        name: name,
        email: email,
        avatar: '',
        status: 'online'
      });
      alert("Registration successful!");
      document.getElementById('register-form').classList.add('hidden');
      document.getElementById('login-form').classList.remove('hidden');
    })
    .catch(err => alert(err.message));
  }

  function login() {
    const email = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;

    if (!email || !password) return alert("Please enter email and password!");

    auth.signInWithEmailAndPassword(email, password)
    .then(() => {
      document.getElementById('auth-container').classList.add('hidden');
      document.getElementById('profile-container').classList.remove('hidden');
      loadProfile();
    })
    .catch(err => alert(err.message));
  }

  function logout() {
    auth.signOut().then(() => {
      document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
      document.getElementById('auth-container').classList.remove('hidden');
    });
  }

  // ===== PROFILE =====
  function loadProfile() {
    const user = auth.currentUser;
    if (!user) return;

    db.ref('users/' + user.uid).once('value').then(snapshot => {
      const data = snapshot.val();
      document.getElementById('profile-name').value = data?.name || '';
      if (data?.avatar) document.getElementById('profile-avatar').src = data.avatar;
    });
  }

  function uploadAvatar(e) {
    const file = e.target.files[0];
    const user = auth.currentUser;
    if (!file || !user) return;

    const ref = storage.ref('avatars/' + user.uid);
    ref.put(file).then(() => {
      ref.getDownloadURL().then(url => {
        db.ref('users/' + user.uid + '/avatar').set(url);
        document.getElementById('profile-avatar').src = url;
      });
    });
  }

  function saveProfile() {
    const user = auth.currentUser;
    const name = document.getElementById('profile-name').value;
    db.ref('users/' + user.uid + '/name').set(name);
    alert('Profile updated!');
  }

  // ===== CHAT =====
  let chatPartnerEmail = '';

  function openChat() {
    document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
    document.getElementById('chat-container').classList.remove('hidden');
  }

  function sendMessage() {
    const user = auth.currentUser;
    const receiverEmail = document.getElementById('chat-with').value.trim();
    const msg = document.getElementById('message-input').value.trim();
    if (!receiverEmail || !msg) return;

    const msgData = {
      from: user.email,
      to: receiverEmail,
      message: msg,
      time: Date.now()
    };

    const chatId = [user.email, receiverEmail].sort().join('_').replace(/[.@]/g, '');
    db.ref('chats/' + chatId).push(msgData);
    document.getElementById('message-input').value = '';
  }

  document.getElementById('chat-with').addEventListener('input', function() {
    const user = auth.currentUser;
    const receiverEmail = this.value.trim();
    const chatId = [user.email, receiverEmail].sort().join('_').replace(/[.@]/g, '');
    const chatBox = document.getElementById('chat-box');
    chatBox.innerHTML = '';

    db.ref('chats/' + chatId).on('child_added', snapshot => {
      const msg = snapshot.val();
      const div = document.createElement('div');
      div.classList.add('message', msg.from === user.email ? 'sent' : 'received');
      div.textContent = msg.message;
      chatBox.appendChild(div);
      chatBox.scrollTop = chatBox.scrollHeight;
    });
  });

  // ===== SETTINGS =====
  function openSettings() {
    document.querySelectorAll('.container').forEach(c => c.classList.add('hidden'));
    document.getElementById('settings-container').classList.remove('hidden');
  }

  function updateSettings() {
    const user = auth.currentUser;
    const newName = document.getElementById('settings-name').value;
    if (!newName) return alert("Name cannot be empty!");
    db.ref('users/' + user.uid + '/name').set(newName);
    alert('Settings saved!');
  }

</script>
</body>
</html>